angular.module("angular-fui").directive("fuiSlider",function(){return{restrict:"E",replace:!0,transclude:!1,scope:{min:"@",max:"@",value:"=",minLabel:"@",maxLabel:"@",labelFunction:"=?",step:"@",values:"="},templateUrl:"scripts/directives/angular-fui/fui-slider/fui-slider.html",controller:function($scope,$document,$element){$scope.position=0,$scope.grabbed=!1,$scope.segments=[];var initBounds=function(){!angular.isDefined($scope.min)&&angular.isDefined($scope.values)&&($scope.min=0,$scope.max=$scope.values.length-1,$scope.step=1)},getPxPerStep=function(){var eWidth=$element[0].clientWidth;angular.isDefined($scope.max)&&angular.isDefined($scope.min)||initBounds();var totalSteps=Math.round(($scope.max-$scope.min)/$scope.step),v=Math.ceil(eWidth/totalSteps);$scope.segments=[];for(var i=0;totalSteps-1>i&&v>10;i++)$scope.segments.push({id:i,px:v});return v};$scope.getClickX=function($event){return $event.clientX-$element.offset().left},$scope.adjustSlider=function(clickX){initBounds();var eWidth=$element[0].clientWidth,pxPerStep=getPxPerStep(),steps=Math.round(clickX/pxPerStep),shift=pxPerStep*steps;shift>eWidth&&(shift=eWidth),0>shift&&(shift=0),$scope.position=shift,$scope.value=angular.isDefined($scope.values)?$scope.values[steps]:$scope.min+steps*$scope.step},$scope.mouseMoved=function($event){$scope.grabbed===!0&&($event.stopPropagation(),$event.preventDefault(),$scope.adjustSlider($scope.getClickX($event)),$scope.$apply())},$scope.setValue=function(){var pxPerStep=getPxPerStep();if(!isNaN(pxPerStep)&&0!==pxPerStep){var steps=0;if(angular.isDefined($scope.values))for(steps=0;steps<$scope.values.length&&$scope.values[steps]!==$scope.value;steps++);else steps=Math.round($scope.value/$scope.step),$scope.value=$scope.min+steps*$scope.step;$scope.position=pxPerStep*steps}},$document.on("mousemove",null,$scope.mouseMoved),$document.on("mouseup",null,function(){$scope.grabbed=!1}),$scope.$on("destroy",function(){$document.off("mousemove",null,$scope.mouseMoved),$document.off("mouseup",null,function(){$scope.grabbed=!1})}),$scope.$on("fds::fui-slider-refresh",$scope.setValue),$scope.setValue()},link:function($scope,$element,$attrs){angular.isDefined($attrs.step)||($attrs.step=1),angular.isDefined($attrs.min)&&"number"!=typeof $attrs.min&&($attrs.min=parseInt($attrs.min)),angular.isDefined($attrs.max)&&"number"!=typeof $attrs.max&&($attrs.max=parseInt($attrs.max))}}});