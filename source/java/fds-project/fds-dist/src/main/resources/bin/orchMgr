#!/bin/bash

##
# this script is used for testing only, should not be used in production
# environment

args=${@}

export fds_root=/fds

for i in "$@"
do
  case $i in
    --fds-root=*)
      FDS_ROOT="${i#*=}"
      ;;
    
    --debug-port=*)
      DEBUG_PORT="${i#*=}"
      ;;
      
    *)
      # unknown option
      ;;
  esac
  shift # past argument or value
done

# LD_LIBRARY_PATH dependencies
export LD_LIBRARY_PATH=../lib
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/opt/fds-deps/embedded/lib
export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/opt/fds-deps/embedded/jre/lib/amd64

export PATH=/usr/local/sbin
export PATH=${PATH}:/usr/local/bin
export PATH=${PATH}:/usr/sbin
export PATH=${PATH}:/usr/bin
export PATH=${PATH}:/sbin
export PATH=${PATH}:/bin
export PATH=${PATH}:/opt/fds-deps/embedded/bin
export PATH=${PATH}:/opt/fds-deps/embedded/jre/bin
export PATH=${PATH}:./bin
export PATH=${PATH}:../sbin

if [[ ! -z "${DEBUG_PORT}" ]]; then
    DEBUG_OPTS='-Xdebug -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address='"${DEBUG_PORT}"
fi

# JAVA dependencies
export JAVA_OPTS="-Xmx2048M -Xms20M"
export JAVA_HOME=/opt/fds-deps/embedded/jre

# JAVA CLASSPATH dependencies
export CLASSPATH=${CLASSPATH}:../lib/java/\*

# JAVA Main executable dependency
export MAIN_CLASS=com.formationds.om.Main

${JAVA_HOME}/bin/java ${JAVA_OPTS} -cp ${CLASSPATH} ${DEBUG_OPTS} ${MAIN_CLASS} --foreground --fds-root=${fds_root} > ./om.out 2>&1
