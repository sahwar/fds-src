#!/bin/bash

args=$*

JAVA_OPTS="-Xmx1024M -Xms20M"

FDS_ROOT=/fds
FDS_OM_HOST=localhost

for i in "$@"
do
  case $i in
    --fds-root=*)
      FDS_ROOT="${i#*=}"
      ;;
    
    --debug-port=*)
      DEBUG_PORT="${i#*=}"
      ;;
      
    *)
      # unknown option
      ;;
  esac
  shift # past argument or value
done

CLASSPATH=$FDS_ROOT/lib/java/*
CLASSPATH=$CLASSPATH:$FDS_ROOT/etc/
CLASSPATH=$CLASSPATH:$FDS_ROOT/etc/ssl
CLASSPATH=$CLASSPATH:$FDS_ROOT/etc/ssl/dev

echo "FDS_ROOT  = $FDS_ROOT"
echo "CLASSPATH = $CLASSPATH"

if [[ ! -z "${DEBUG_PORT}" ]]; then
    DEBUG_OPTS='-Xdebug -agentlib:jdwp=transport=dt_socket,server=y,suspend=n,address='"${DEBUG_PORT}"
fi

java $JAVA_OPTS -classpath $CLASSPATH ${DEBUG_OPTS} com.formationds.om.Main $args
